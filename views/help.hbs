{{> messages}}
<div style="margin-bottom: 130px;">
  <div class="title">
    <h3>ÂÆ¢Êúç</h3>
  </div>

  <div class="container mt-3 mb-3">
    <div class="row">
      <div class="col-sm-10 mx-auto">
        <div class="card">
          <div id="messages" class="my-2 overflow-auto" style="max-height: 400px;">
            {{#each messages}}
            <div class="card-body">
              <span style="border-bottom: 3px solid rgb(0, 70, 71);">{{this.User.name}}</span>
              Ôºö{{this.content}}
              <span style="color: gray; font-size: 0.5rem">{{this.createdAt}}</span>
            </div>
            {{/each}}
          </div>
          <form id="help-form" class="d-flex mb-1 mx-1">
            <input id="content" type="text" placeholder="Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑÂïèÈ°å" class="form-control me-1" autofocus><button
              class="btn" type="submit" style="background-color: rgb(32, 195, 198)"><i class="fa-solid fa-paper-plane"
                style="color: white"></i></button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.socket.io/4.6.0/socket.io.min.js"
  integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+" crossorigin="anonymous"></script>
<script>
  const socket = io()
  const helpForm = document.getElementById('help-form')
  const messages = document.getElementById('messages')
  // ÂÆ¢ÊúçË¶ñÁ™óËá™Âãï‰∏ãÊªëÂà∞Â∫ïÈÉ®
  messages.scrollTop = messages.scrollHeight

  // ÈÄÅÂá∫ content
  helpForm.addEventListener('submit', event => {
    console.log('üì¢ ÈÄÅÂá∫!!!')
    event.preventDefault()

    const content = event.target.firstElementChild.value
    if (content.trim().length > 0) {
      socket.emit('content', content.trim())
    }
    event.target.firstElementChild.value = ''
    event.target.firstElementChild.focus()
  })

  // Êî∂Âà∞ message ÊôÇ
  socket.on('message', newMsg => {
    const newMsgCard = document.createElement('div')
    newMsgCard.classList.add('card-body')
    newMsgCard.innerHTML = `
      <span style="border-bottom: 3px solid rgb(0, 70, 71);">${newMsg.name}</span>
      Ôºö${newMsg.content}
      <span style="color: gray; font-size: 0.5rem">${newMsg.createdAt}</span>
    `
    messages.appendChild(newMsgCard)
    messages.scrollTop = messages.scrollHeight
  })
</script>